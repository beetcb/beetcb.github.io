---
layout: post
title: Gitä¹‹ä¿®æ”¹commitè®°å½•
author: beet
post: '@11@'
date: 2020-06-22 19:50:04
nailimg: https://static.beetcb.com/nailimg/git.png
tags: git
---

> åœ¨å¾ˆå¤šå½±è§†ä½œå“é‡Œï¼Œå°±ç®—ä¸»äººå…¬ä¹˜ä¸Šäº†æ—¶å…‰é¸¡ï¼Œè¿˜æ˜¯æ— æ³•ä¿®æ”¹å†å²ï¼ˆæˆ–è€…è¯´ä¿®æ”¹åé€ æˆååˆ†ä¸¥é‡çš„åæœï¼‰ï¼›è€Œç°åœ¨ï¼Œåœ¨ Git çš„å¼ºåŠ›é©±åŠ¨ä¸‹ï¼Œä¿®æ”¹å†å²å˜å¾—ç®€å•åˆç›¸å¯¹å®‰å…¨ã€‚
>
> æœ¬æ–‡å¨å¨ä¿®æ”¹ commit å†å²çš„é—®é¢˜

#### åº”ç”¨åœºæ™¯

â‘  åˆšåˆšçš„æäº¤ä¸å°å¿ƒæ‰“é”™äº† ğŸ‘‹ èƒ½æ›´æ”¹å—ï¼Ÿ

æ¯”å¦‚`Sun of a Beach with canvas` å†™æˆäº† `son of a b**ch with canvas`

â‘¡ åˆšåˆšçš„æäº¤æ¼æ‰äº†æ–‡ä»¶ ğŸ‘‹ èƒ½è¿½åŠ å—ï¼Ÿ

â‘¢ ä»¥å‰å†™çš„ commit å¾ˆèœ ğŸ‘‹ èƒ½æ›´æ”¹å—ï¼Ÿ

å¯èƒ½ä½ çš„ commit æ˜¯è¿™æ ·çš„ :

`fix bug`

`fix another bug`

`fix final bug`

`oh anotherOne wtf?`

![](https://static.beetcb.com/postimg/11/1.png)

#### é­”æ³•ä¸€ï¼šgit coomit --amend -m ''ğŸƒ

å¯¹äºåœºæ™¯ â‘ ï¼Œå¯ä»¥è¿™æ ·æ€¥æ•‘

```bash
git coomit --amend -m 'Sun of a Beach with canvas'
```

**å®é™…æ•ˆæœå›¾**ï¼š

![](https://static.beetcb.com/postimg/11/2.png)

å¦‚æœæ²¡æœ‰åŠ  <code>-m</code>å‚æ•°çš„è¯ï¼Œä¼šå¼¹å‡º vim è®©ä½ ç¼–è¾‘æœ€è¿‘ä¸€æ¬¡çš„ commit

**æ³¨æ„**ï¼š

- <code>--amend</code> åªèƒ½ä¿®æ”¹æœ€è¿‘çš„ä¸€æ¬¡ commit
- æœ€è¿‘çš„é‚£ä¸€æ¬¡ commit ç‰©ä»¶çš„ SHA1 è¢«æ–°çš„ SHA1 å€¼æ›¿ä»£ï¼Œå› ä¸ºå¯¹äº `commit ç‰©ä»¶` æ¥è¯´å®ƒçš„å†…å®¹å‘ç”Ÿäº†æ”¹å˜
- commit çš„æ—¶é—´å¹¶æœªè¢«ä¿®æ”¹ï¼Œå› ä¸ºæ—¶é—´ä½œè€…ä¿¡æ¯æ˜¯ç”± `treeç‰©ä»¶` å‚¨å­˜ï¼Œæ–‡ä»¶ã€æ–‡ä»¶ç›®å½•ç»“æ„å•¥éƒ½æ²¡å˜ï¼Œtree ç‰©ä»¶ä¸å¯èƒ½å˜åŒ–

åŒæ—¶ï¼Œå¯¹äºåœºæ™¯äºŒ ï¼Œ<code>--amend</code> ä¹Ÿèƒ½å¤„ç†

```bash
#å…ˆæŠŠæ¼æ‰çš„æ–‡ä»¶åŠ å…¥ç¼“å­˜åŒº
git add careless.less
#å†ä½¿ç”¨--amendå‚æ•°è¿›è¡Œcommit,ä¸‹é¢--no-edit è¡¨ç¤ºä¿ç•™åŸæœ‰messageä¿¡æ¯
git commit --amend --no-edit
```

æ³¨æ„ï¼š

- commit çš„æ—¶é—´å¹¶ä¼šå‘ç”Ÿå˜åŒ–

#### é­”æ³•äºŒï¼šgit resetğŸƒ

å¯¹äºåœºæ™¯ â‘¡ï¼Œå¦ä¸€ç§å¤„ç†æ–¹å¼æ˜¯<code>git reset</code>æŒ‡ä»¤

<code>git reset</code>æŒ‡ä»¤æ˜¯è·³å›ä¹‹å‰çš„æŸæ¬¡ commit ï¼ˆè€Œéå­—é¢é‡ç½®çš„æ„æ€ï¼‰

> é™„åŠ çŸ¥è¯†ï¼šå®šä½åˆ°é‚£ä¸€æ¬¡ commit çš„å¤šç§æ–¹å¼
>
> - é€šè¿‡ HEAD æˆ–å½“å‰åˆ†æ”¯ï¼ˆæ¯”å¦‚ masterï¼‰ => åƒè´´çº¸ä¸€æ ·æŒ‡å‘å½“å‰çš„ commitï¼Œ
>
>   å†åŠ ä¸Š <code>^</code> è¡¨ç¤ºå½“å‰ commit çš„å‰ä¸€æ¬¡ ï¼Œæˆ–è€…<code>~n</code> è¡¨ç¤ºå½“å‰ commit çš„å‰ n æ¬¡
>
> - é€šè¿‡ SHA1 å€¼çš„ç®€å†™ => æ¯”å¦‚ `e2d2873`

æ‰€ä»¥å¯ä»¥é€€å›åˆ°ä¹‹å‰çš„ commit => é‡æ–°æ·»åŠ æ–‡ä»¶ => å†æ¬¡ commit

é€€å›ä¸Šä¸€æ¬¡çš„ commit çš„ä¸‰ç§å†™æ³•ï¼š

```bash
git reset e2d273 #opt1ï¼šåˆ©ç”¨ä¸Šä¸€æ¬¡çš„SHA1ç®€å†™å€¼
git reset HEAD^ #opt2: åˆ©ç”¨HEAD
git reset master^ #opt3: åˆ©ç”¨å½“å‰æ‰€åœ¨åˆ†æ”¯
```

**å®é™…æ•ˆæœå›¾**ï¼š

![](https://static.beetcb.com/postimg/11/3.png)

#### é­”æ³•ä¸‰ï¼šgit rebaseğŸƒ

å¯¹äºæƒ…æ™¯ â‘¢ï¼Œå½“ä½ å†™äº†â€˜æŠ˜ç£¨å¤šâ€™æ— ç”¨ commitï¼Œåˆ«æ€¥ç€åˆ æ‰ .git ç›®å½• ğŸ‘»ï¼›å…ˆè¯•è¯• <code>git rebase</code>(åªæ¶‰åŠåˆ° rebase é™„åŠ çš„ä¸€ä¸ªå°å°çš„åº”ç”¨ï¼Œåœ¨æ¥ä¸‹æ¥çš„åº”ç”¨ä¸­å¯ä»¥æƒ³è±¡æˆ HEAD ä¸€ç›´é¡ºç€ commit å¾€ä¸‹èµ°ï¼Œé‡åˆ°é`pick` çš„ commit å°±ä¼šåœä¸‹æ¥ï¼Œç­‰å¾…ä½ æ“ä½œè¿™ä¸ª commit)

##### 1.git log çœ‹çœ‹ç°æœ‰çš„ commit

```javascript
git log --oneline
```

![](https://static.beetcb.com/postimg/11/4.png)

##### 2.ç¡®å®šæ“ä½œçš„èŒƒå›´

```javascript
git rebase -i 4d11e38
#æ­¤å¤„-iè¡¨ç¤ºinteractive äº¤äº’å¼çš„rebaseè¿‡ç¨‹
```

![](https://static.beetcb.com/postimg/11/5.png)

##### 3.æŠŠéœ€è¦ä¿®æ”¹çš„ commit å‰é¢ <code>pick</code> æ”¹ä¸º <code>r</code>

![](https://static.beetcb.com/postimg/11/6.png)

ä¿å­˜å¹¶é€€å‡º vim ç¼–è¾‘å™¨

##### 4.æ­£å¼ä¿®æ”¹ commit

`go to jail` æ”¹æˆ `go to party` æ˜¯ä¸æ˜¯æ½‡æ´’çš„å¤šå‘¢ ğŸ¶

é€€å‡ºä¿å­˜åï¼Œå†æ¬¡æŸ¥çœ‹ commit

![](https://static.beetcb.com/postimg/11/7.png)

æˆ‘ä»¬å†é‡æ–°çœ‹çœ‹è¿™å¼ å›¾ï¼Œ

![](https://static.beetcb.com/postimg/11/8.png)

ç»†å¿ƒçš„ä½ æœ‰æ²¡æœ‰å‘ç° é™¤äº†å¯ä»¥ `r`(ä¹Ÿå°±æ˜¯ reword commit) è¿˜æœ‰å¾ˆå¤šå¼ºå¤§çš„æ“ä½œï¼Œè¿™é‡Œä¸¾ä¸¤ä¸ªæ —å­ï¼š

- `e` ï¼šedit commit ï¼Œå¯ä»¥å®ç°å¯¹ commit çš„é«˜çº§ä¿®æ”¹ï¼šæ¯”å¦‚å¹²æ‰è¿™ä¸ª commitï¼Œé‡æ–°æäº¤
- `s` ï¼šsquash commitï¼Œå¯ä»¥å®ç°åˆå¹¶å¤šä¸ª commitï¼šä¼šå‘æ›´æ—©çš„é‚»å±… commit ç‰©ä»¶å»åˆå¹¶ï¼ŒåŒæ—¶ä¼šç»™ä½ ä¿®æ”¹ message çš„æœºä¼š
- `d `ï¼šdrop commit ï¼ŒæŠŠå®ƒä¸¢æ‰=> æŠŠè¿™ä¸ª commit åˆ é™¤
- å¦å¤–ä¸€ä¸ªéªšæ“ä½œï¼šåªè¦åœ¨ rebase å¼¹å‡ºçš„ç¼–è¾‘å™¨é‡Œé¢æ‰‹åŠ¨ä¿®æ”¹ commit è¡Œçš„ä½ç½®ï¼Œå°±å¯ä»¥å®ç°`ä¿®æ”¹commitçš„é¡ºåº`çš„æ•ˆæœã€‚åŒç†å•¦ï¼Œåˆ æ‰æŸä¸€è¡Œä¹Ÿå°±å®ç°äº†`åˆ æ‰äº†è¿™ä¸ªcommit`çš„æ•ˆæœ

#### ä½ å¯èƒ½ä¼šæƒ³ï¼šreset å›å»æ”¹ commit ä¿¡æ¯

> æ—¢ç„¶ <code>git reset</code> å¯ä»¥è·³å›ä¹‹å‰çš„ commit ï¼Œä¸¤æ¬¡ç›¸åçš„ reset ä¸å°±å›åˆ°äº†å½“å‰æäº¤å—ï¼Ÿ

> å¯¹äºæƒ…æ™¯ â‘¢ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¾æ¬¡è·³åˆ°å„ä¸ª commit ï¼Œæ¬ç – ... æœ€ååˆ©ç”¨ <code>git reflog</code> æŸ¥æ‰¾ commit ä¿¡æ¯è·³å›æ¥

ä½†æ˜¯ï¼Œæ–°çš„ commit ç‰©ä»¶å¹¶æ²¡æœ‰è¢«ä¹‹åçš„ commit æ‰€æŒ‡åˆ° ï¼Œå½“ä½ å†æ¬¡ reset å›å»çš„æ—¶å€™ï¼Œä¸€åˆ‡è¿˜æ˜¯åŸæ¥çš„æ ·å­ã€‚ä¸ä¿¡ä½ çœ‹

![](https://static.beetcb.com/postimg/11/9.png)

é™¤éä½ æ„¿æ„å»æ‰‹åŠ¨ä¿®æ”¹ commit çš„æŒ‡å‘ï¼Œå¯èƒ½ä¼šç”Ÿæ•ˆå§

#### ä½†æ˜¯

å¦‚æœæ˜¯çœŸå®å¼€å‘çš„è¯ï¼Œå·²ç» push å‡ºå»çš„ commit ä¸è¦ä¿®æ”¹äº†ï¼ˆä¼šå¼•å‘è®¸å¤šéº»çƒ¦ï¼‰ï¼Œå°±è®©å¾€äº‹éƒ½éšé£å§ o((>Ï‰< ))oã€‚

![](https://tvax4.sinaimg.cn/large/005K67iLgy1gg1fq053dsg30dw092whw.gif)
